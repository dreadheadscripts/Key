<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Script Maniac Hub KeySystem - Final Step</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background-color: #1a0030;
    border: 10px solid #002f6c;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex; align-items: center; justify-content: center;
    color: #00c3ff;
    transition: background-color 0.3s ease;
  }
  body.light-mode {
    background-color: #e0e7ff;
    color: #003366;
    border-color: #004080;
  }
  .container {
    background-color: #000;
    border: 4px solid #002f6c;
    color: #00c3ff;
    padding: 50px 40px 60px;
    border-radius: 25px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.6);
    max-width: 550px;
    width: 90%;
    text-align: center;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  }
  body.light-mode .container {
    background-color: #f0f4ff;
    color: #004080;
    border-color: #004080;
    box-shadow: 0 15px 30px rgba(0,0,50,0.3);
  }
  h1 {
    font-size: 28px;
    margin-bottom: 5px;
  }
  p {
    font-size: 18px;
    margin: 5px 0 35px;
  }
  .progress {
    font-size: 14px;
    margin-bottom: 30px;
    opacity: 0.6;
  }
  .timer {
    font-size: 16px;
    margin-bottom: 25px;
    font-weight: 600;
  }
  button {
    background-color: #007bff;
    color: white;
    font-size: 17px;
    padding: 14px 28px;
    border: 2px solid white;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.25s ease;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background-color: #005ec2;
    transform: scale(1.05);
  }
  button:disabled {
    background-color: #003366;
    cursor: not-allowed;
    border-color: #004080;
  }
  .restart-btn {
    background: transparent;
    border: none;
    color: #00c3ff;
    font-size: 14px;
    margin-top: 25px;
    cursor: pointer;
    text-decoration: underline;
    opacity: 0.7;
    user-select: none;
  }
  .restart-btn:hover {
    opacity: 1;
  }
  #darkToggle {
    position: fixed;
    top: 15px;
    right: 20px;
    background: transparent;
    border: 2px solid #00c3ff;
    color: #00c3ff;
    padding: 8px 14px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
    transition: all 0.3s ease;
  }
  #darkToggle:hover {
    background-color: #005ec2;
    color: white;
    border-color: #005ec2;
  }
  #keyBox {
    font-family: monospace;
    font-size: 22px;
    letter-spacing: 3px;
    margin: 15px auto 10px;
    padding: 10px 18px;
    border: 2px solid #00c3ff;
    border-radius: 12px;
    max-width: 340px;
    user-select: all;
    background: #000;
    color: #00c3ff;
  }
  #copyBtn {
    display: none;
    margin-top: 8px;
    background-color: #007bff;
    color: white;
    font-size: 15px;
    padding: 10px 18px;
    border: 2px solid white;
    border-radius: 12px;
    cursor: pointer;
    user-select: none;
    transition: all 0.25s ease;
  }
  #copyBtn:hover {
    background-color: #005ec2;
    transform: scale(1.05);
  }
  #captchaContainer {
    margin-top: 20px;
    margin-bottom: 15px;
  }
  #captchaQuestion {
    font-weight: 600;
    font-size: 18px;
    margin-bottom: 10px;
  }
  #captchaInput {
    font-size: 16px;
    padding: 8px 12px;
    border-radius: 12px;
    border: 2px solid #00c3ff;
    width: 90px;
    text-align: center;
    outline: none;
    color: #00c3ff;
    background: #000;
    margin-bottom: 12px;
  }
  body.light-mode #captchaInput {
    background: #f0f4ff;
    color: #004080;
  }
  #captchaSubmitBtn {
    background-color: #007bff;
    color: white;
    font-size: 16px;
    padding: 10px 20px;
    border: 2px solid white;
    border-radius: 12px;
    cursor: pointer;
    user-select: none;
    transition: all 0.25s ease;
  }
  #captchaSubmitBtn:disabled {
    background-color: #003366;
    cursor: not-allowed;
    border-color: #004080;
  }
  #captchaSubmitBtn:hover:not(:disabled) {
    background-color: #005ec2;
    transform: scale(1.05);
  }
</style>
</head>
<body>
  <button id="darkToggle" aria-label="Toggle Dark/Light Mode">Light Mode</button>
  <div class="container" role="main" aria-label="Key System Final Step">
    <div class="progress" aria-live="polite">Step 3 of 3</div>
    <h1>Script Maniac Hub KeySystem</h1>
    <p>Final Checkpoint: Key</p>
    <div class="timer" id="countdown" aria-live="polite" aria-atomic="true">Loading timer...</div>

    <div id="captchaContainer" aria-live="polite">
      <div id="captchaQuestion">Loading captcha...</div>
      <input type="text" id="captchaInput" aria-label="Enter captcha answer" autocomplete="off" />
      <br />
      <button id="captchaSubmitBtn" disabled>Generate Key</button>
    </div>

    <div id="keyBox" aria-live="polite" style="display:none;" tabindex="0" role="textbox" aria-readonly="true"></div>
    <button id="copyBtn" aria-label="Copy key to clipboard">Copy Key</button>

    <button class="restart-btn" id="restartBtn" aria-label="Restart the entire process">Restart Process</button>

    <div class="security-badge" aria-hidden="true" title="Security Verified by Script Maniac Hub">
      <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5 3.8 9.8 9 11 5.2-1.2 9-6 9-11V5l-9-4zM10 16l-4-4 1.4-1.4 2.6 2.6 5.6-5.6L16 9l-6 7z"/></svg>
      Security Verified
    </div>
    <div class="footer" aria-hidden="true">Â© 2025 Script Maniac Hub</div>
  </div>

<script>
(() => {
  // Dark mode toggle
  const darkToggle = document.getElementById('darkToggle');
  const body = document.body;
  function updateDarkToggleText() {
    darkToggle.textContent = body.classList.contains('light-mode') ? 'Dark Mode' : 'Light Mode';
  }
  darkToggle.onclick = () => {
    body.classList.toggle('light-mode');
    updateDarkToggleText();
    localStorage.setItem('smh_darkMode', body.classList.contains('light-mode') ? '1' : '0');
  };
  // Initialize dark mode based on saved preference
  if (localStorage.getItem('smh_darkMode') === '1') {
    body.classList.add('light-mode');
  }
  updateDarkToggleText();

  // Constants
  const MAX_SESSION_MS = 3 * 60 * 60 * 1000; // 3 hours
  const MAX_KEY_MS = 8 * 60 * 60 * 1000; // 8 hours key validity
  const COOLDOWN_MS = 24 * 60 * 60 * 1000; // 24 hours cooldown between key gens
  const startTimeKey = 'smh_startTime';
  const keyStorageKey = 'generatedKey';
  const keyTimeKey = 'generatedKeyTime';

  // Referral check (redirect if missing ?ref=link)
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('ref') !== 'link') {
    alert('Please access this page through the Linkvertise redirect link.');
    location.href = 'index.html';
    return;
  }

  // Session start time check
  let startTime = localStorage.getItem(startTimeKey);
  if (!startTime) {
    alert('Session not started properly. Redirecting to start.');
    location.href = 'index.html';
    return;
  }
  if (Date.now() - parseInt(startTime, 10) > MAX_SESSION_MS) {
    alert('Session expired. Please restart the process.');
    localStorage.clear();
    location.href = 'index.html';
    return;
  }

  // Countdown timer element
  const countdown = document.getElementById('countdown');
  function updateCountdown() {
    const now = Date.now();
    const elapsed = now - parseInt(localStorage.getItem(startTimeKey), 10);
    const remaining = MAX_SESSION_MS - elapsed;
    if (remaining <= 0) {
      alert('Session expired. Please restart the process.');
      localStorage.clear();
      location.href = 'index.html';
      return;
    }
    const hrs = Math.floor(remaining / (1000 * 60 * 60));
    const mins = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
    const secs = Math.floor((remaining % (1000 * 60)) / 1000);
    countdown.textContent = `Time remaining: ${hrs.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
  }
  updateCountdown();
  setInterval(updateCountdown, 1000);

  // Key and cooldown from storage
  let storedKey = localStorage.getItem(keyStorageKey);
  let storedKeyTime = localStorage.getItem(keyTimeKey);

  // UI elements
  const captchaContainer = document.getElementById('captchaContainer');
  const captchaQuestion = document.getElementById('captchaQuestion');
  const captchaInput = document.getElementById('captchaInput');
  const captchaSubmitBtn = document.getElementById('captchaSubmitBtn');
  const keyBox = document.getElementById('keyBox');
  const copyBtn = document.getElementById('copyBtn');
  const restartBtn = document.getElementById('restartBtn');

  // Generate random key in format SMH-XXXX-XXXX-XXXX
  function generateKey() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    function segment() {
      let str = '';
      for(let i=0; i<4; i++) {
        str += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return str;
    }
    return `SMH-${segment()}-${segment()}-${segment()}`;
  }

  // Captcha generator (simple sum)
  let num1, num2;
  function generateCaptcha() {
    num1 = Math.floor(Math.random() * 10) + 1;
    num2 = Math.floor(Math.random() * 10) + 1;
    captchaQuestion.textContent = `What is ${num1} + ${num2}?`;
    captchaInput.value = '';
    captchaSubmitBtn.disabled = true;
  }
  generateCaptcha();

  captchaInput.addEventListener('input', () => {
    captchaSubmitBtn.disabled = captchaInput.value.trim() !== (num1 + num2).toString();
  });

  function showKey(k) {
    captchaContainer.style.display = 'none';
    keyBox.style.display = 'block';
    keyBox.textContent = k;
    copyBtn.style.display = 'inline-block';
  }

  function copyKey() {
    navigator.clipboard.writeText(keyBox.textContent).then(() => {
      alert('Key copied to clipboard!');
    }).catch(() => {
      alert('Failed to copy key.');
    });
  }

  // Check if key exists and is valid (8 hours)
  if (storedKey && storedKeyTime) {
    const age = Date.now() - parseInt(storedKeyTime, 10);
    if (age < MAX_KEY_MS) {
      // Key still valid, show it
      showKey(storedKey);
      captchaContainer.style.display = 'none';
      // Disable generation button anyway
      captchaSubmitBtn.disabled = true;
    } else {
      // Key expired, clear stored key
      localStorage.removeItem(keyStorageKey);
      localStorage.removeItem(keyTimeKey);
      generateCaptcha();
    }
  }

  captchaSubmitBtn.onclick = () => {
    // Check cooldown
    if (storedKeyTime) {
      const lastGenAge = Date.now() - parseInt(storedKeyTime, 10);
      if (lastGenAge < COOLDOWN_MS) {
        alert('You must wait 24 hours before generating a new key.');
        return;
      }
    }
    // Generate and store key
    const newKey = generateKey();
    localStorage.setItem(keyStorageKey, newKey);
    localStorage.setItem(keyTimeKey, Date.now().toString());
    showKey(newKey);
    captchaContainer.style.display = 'none';
  };

  copyBtn.onclick = copyKey;

  restartBtn.onclick = () => {
    if (confirm('Are you sure you want to restart the process? This will clear your session and keys.')) {
      localStorage.clear();
      location.href = 'index.html';
    }
  };

})();
</script>
</body>
</html>
